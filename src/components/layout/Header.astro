---
import { t } from "../../utils/i18n";

export interface Props {
  lang?: "en" | "fr" | "ru" | "de";
}

const { lang = "en" } = Astro.props;
---

<header
  class="sticky top-0 z-50 border-b border-primary-200 dark:border-primary-800 bg-white/80 dark:bg-primary-900/80 backdrop-blur-sm"
>
  <div class="container mx-auto px-4 py-4">
    <nav class="flex items-center justify-between">
      <a
        href="/"
        class="flex items-center gap-2 text-2xl font-bold text-accent-600 dark:text-accent-500 hover:opacity-80 transition-opacity"
      >
        <svg
          class="w-10 h-10 drop-shadow-lg text-accent-600 dark:text-accent-500"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 128 128"
          aria-hidden="true"
          focusable="false"
        >
          <path
            d="M50.4 78.5a75.1 75.1 0 0 0-28.5 6.9l24.2-65.7c.7-2 1.9-3.2 3.4-3.2h29c1.5 0 2.7 1.2 3.4 3.2l24.2 65.7s-11.6-7-28.5-7L67 45.5c-.4-1.7-1.6-2.8-2.9-2.8-1.3 0-2.5 1.1-2.9 2.7L50.4 78.5Zm-1.1 28.2Zm-4.2-20.2c-2 6.6-.6 15.8 4.2 20.2a17.5 17.5 0 0 1 .2-.7 5.5 5.5 0 0 1 5.7-4.5c2.8.1 4.3 1.5 4.7 4.7.2 1.1.2 2.3.2 3.5v.4c0 2.7.7 5.2 2.2 7.4a13 13 0 0 0 5.7 4.9v-.3l-.2-.3c-1.8-5.6-.5-9.5 4.4-12.8l1.5-1a73 73 0 0 0 3.2-2.2 16 16 0 0 0 6.8-11.4c.3-2 .1-4-.6-6l-.8.6-1.6 1a37 37 0 0 1-22.4 2.7c-5-.7-9.7-2-13.2-6.2Z"
            fill="currentColor"
          />
        </svg>
        <span>{t("siteName", lang)}</span>
      </a>

      <div class="flex items-center gap-4 md:gap-6">
        <a
          href="/"
          class="hover:text-accent-600 transition-colors hidden md:inline"
        >
          {t("home", lang)}
        </a>
        <a href="/reviews" class="hover:text-accent-600 transition-colors">
          {t("reviews", lang)}
        </a>
        <a href="/categories" class="hover:text-accent-600 transition-colors">
          {t("categories", lang)}
        </a>
        <a href="/about" class="hover:text-accent-600 transition-colors">
          {t("about", lang)}
        </a>
        <a href="/contact" class="hover:text-accent-600 transition-colors">
          {t("contact", lang)}
        </a>

        <!-- Language Picker -->
        <div class="relative group">
          <button
            class="flex items-center gap-1 px-3 py-2 rounded-lg bg-primary-100 dark:bg-primary-800 hover:bg-primary-200 dark:hover:bg-primary-700 transition-colors"
          >
            <span class="text-sm font-medium">{lang.toUpperCase()}</span>
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>

          <div
            class="absolute right-0 mt-2 w-32 py-2 bg-white dark:bg-primary-900 rounded-lg shadow-lg border border-primary-200 dark:border-primary-800 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50"
          >
            <a
              href="/"
              onclick="window.__switchLanguage?.('en'); return false;"
              class="block px-4 py-2 hover:bg-primary-100 dark:hover:bg-primary-800 transition-colors"
            >
              <div class="flex items-center gap-2">
                <span class="text-sm">üá∫üá∏</span>
                <span class="text-sm">English</span>
              </div>
            </a>
            <a
              href="/fr/"
              onclick="window.__switchLanguage?.('fr'); return false;"
              class="block px-4 py-2 hover:bg-primary-100 dark:hover:bg-primary-800 transition-colors"
            >
              <div class="flex items-center gap-2">
                <span class="text-sm">üá´üá∑</span>
                <span class="text-sm">Fran√ßais</span>
              </div>
            </a>
            <a
              href="/ru/"
              onclick="window.__switchLanguage?.('ru'); return false;"
              class="block px-4 py-2 hover:bg-primary-100 dark:hover:bg-primary-800 transition-colors"
            >
              <div class="flex items-center gap-2">
                <span class="text-sm">üá∑üá∫</span>
                <span class="text-sm">–†—É—Å—Å–∫–∏–π</span>
              </div>
            </a>
            <a
              href="/de/"
              onclick="window.__switchLanguage?.('de'); return false;"
              class="block px-4 py-2 hover:bg-primary-100 dark:hover:bg-primary-800 transition-colors"
            >
              <div class="flex items-center gap-2">
                <span class="text-sm">üá©üá™</span>
                <span class="text-sm">Deutsch</span>
              </div>
            </a>
          </div>
        </div>

        <!-- Theme Toggle -->
        <button
          id="theme-toggle"
          class="p-2 rounded-lg bg-primary-100 dark:bg-primary-800 hover:bg-primary-200 dark:hover:bg-primary-700 transition-colors"
          aria-label={t("themeToggle", lang)}
        >
          <span class="dark:hidden">üåô</span>
          <span class="hidden dark:inline">‚òÄÔ∏è</span>
        </button>
      </div>
    </nav>
  </div>
</header>

<script>
  // Declare property on window for TypeScript
  interface WindowWithSwitcher extends Window {
    __switchLanguage?: (lang: string) => void;
  }

  // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å—Å—ã–ª–∫–∞—Ö
  (window as unknown as WindowWithSwitcher).__switchLanguage = function (
    lang: string,
  ) {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π —è–∑—ã–∫
    localStorage.setItem("preferredLanguage", lang);

    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø—É—Ç—å
    const currentPath = window.location.pathname;

    // Remove any existing locale prefix (including legacy `/en/...`).
    const pathWithoutLocale = currentPath.replace(/^\/(en|fr|ru|de)(?=\/|$)/, "");
    const normalizedPath = pathWithoutLocale || "/";

    // Default locale (`en`) is not prefixed.
    const newPath = lang === "en" ? normalizedPath : `/${lang}${normalizedPath}`;

    // Preserve query + hash.
    window.location.href = `${newPath}${window.location.search}${window.location.hash}`;
  };
</script>
