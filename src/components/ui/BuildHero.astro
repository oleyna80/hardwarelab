---
import type { ImageMetadata } from "astro";

interface Props {
    image?: string | ImageMetadata;
    title: string;
    description: string;
    totalPrice?: number;
    rating?: number;
}

const { image, title, description, totalPrice, rating } = Astro.props;
const imageSrc = typeof image === "string" ? image : image?.src;

// Format price with default if missing
const formattedPrice = totalPrice
    ? new Intl.NumberFormat("en-US", {
          style: "currency",
          currency: "USD",
      }).format(totalPrice)
    : "TBD";

// Stars generation
const fullStars = rating ? Math.floor(rating) : 0;
const hasHalfStar = rating ? rating % 1 >= 0.5 : false;
const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
---

<div
    class="relative bg-zinc-900 border border-zinc-800 rounded-2xl overflow-hidden mb-12 shadow-2xl"
>
    <div
        class="absolute inset-0 bg-gradient-to-r from-indigo-900/20 to-purple-900/20 pointer-events-none"
    >
    </div>

    <div class="grid md:grid-cols-2 gap-8 p-8 relative z-10">
        <div class="flex flex-col justify-center space-y-6">
            <div>
                <div class="flex items-center gap-3 mb-4">
                    <span
                        class="px-3 py-1 text-xs font-bold uppercase tracking-wider bg-purple-500/10 text-purple-400 border border-purple-500/20 rounded-full"
                    >
                        PC Build Guide
                    </span>
                    {
                        rating && (
                            <div class="flex text-amber-500 text-sm">
                                {"★".repeat(fullStars)}
                                {hasHalfStar && "★"}
                                <span class="text-zinc-600">
                                    {"★".repeat(emptyStars)}
                                </span>
                            </div>
                        )
                    }
                </div>
                <h1
                    class="text-3xl md:text-4xl font-bold text-white mb-4 leading-tight"
                >
                    {title}
                </h1>
                <p class="text-lg text-zinc-400 leading-relaxed">
                    {description}
                </p>
            </div>

            <div
                class="flex flex-col sm:flex-row gap-4 pt-4 border-t border-zinc-800"
            >
                <div
                    class="flex-1 bg-zinc-950/50 p-4 rounded-xl border border-zinc-800"
                >
                    <div class="text-zinc-500 text-sm mb-1">Estimated Cost</div>
                    <div class="text-3xl font-bold text-green-400">
                        {formattedPrice}
                    </div>
                </div>
            </div>
        </div>

        <div
            class="relative h-64 md:h-auto rounded-xl overflow-hidden bg-zinc-950 border border-zinc-800 group"
        >
            {
                imageSrc ? (
                    <img
                        src={imageSrc}
                        alt={title}
                        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                    />
                ) : (
                    <div class="w-full h-full flex items-center justify-center bg-zinc-800 text-zinc-600">
                        <span>No Build Image Preview</span>
                    </div>
                )
            }
        </div>
    </div>
</div>
