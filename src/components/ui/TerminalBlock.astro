---
interface Props {
    commands: string[];
    title?: string;
    language?: 'bash' | 'powershell' | 'cmd' | 'zsh';
    showLineNumbers?: boolean;
    copyable?: boolean;
    darkMode?: boolean;
}

const {
    commands = [],
    title = 'Terminal',
    language = 'bash',
    showLineNumbers = true,
    copyable = true,
    darkMode = true, // По умолчанию темный стиль
} = Astro.props;

// Определяем символ приглашения в зависимости от языка
const promptSymbols = {
    bash: '$',
    powershell: 'PS>',
    cmd: '>',
    zsh: '%',
};

const prompt = promptSymbols[language] || '$';

// Функция для копирования в буфер обмена
const copyToClipboard = (text: string) => {
    navigator.clipboard.writeText(text).then(() => {
        // Можно добавить уведомление, но для простоты оставим базовую реализацию
    });
};
---

<div class="terminal-block font-mono" role="region" aria-label={`Terminal block: ${title}`}>
    {/* Terminal header */}
    <div class={`
        flex items-center justify-between px-4 py-3 rounded-t-lg
        ${darkMode 
            ? 'bg-primary-900 text-primary-200' 
            : 'bg-primary-800 text-primary-100'
        }
    `}>
        <div class="flex items-center space-x-2">
            {/* Terminal dots */}
            <div class="flex space-x-1.5">
                <div class="w-3 h-3 rounded-full bg-red-500"></div>
                <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
            </div>
            <span class="ml-2 text-sm font-medium">
                {title}
            </span>
        </div>
        
        {copyable && (
            <button
                type="button"
                class={`
                    text-xs px-3 py-1 rounded border transition-colors
                    ${darkMode
                        ? 'border-primary-600 hover:border-primary-400 hover:bg-primary-800'
                        : 'border-primary-500 hover:border-primary-300 hover:bg-primary-700'
                    }
                    focus:outline-none focus:ring-2 focus:ring-accent-500
                `}
                onClick={() => copyToClipboard(commands.join('\n'))}
                aria-label="Copy commands to clipboard"
            >
                Copy
            </button>
        )}
    </div>
    
    {/* Terminal content */}
    <div class={`
        rounded-b-lg overflow-x-auto
        ${darkMode 
            ? 'bg-primary-950 text-primary-100' 
            : 'bg-primary-900 text-primary-50'
        }
        p-4
    `}>
        <pre class="whitespace-pre-wrap" role="document">
            {commands.map((command, index) => (
                <div 
                    key={index} 
                    class="terminal-line mb-2 last:mb-0"
                    role="row"
                >
                    {showLineNumbers && (
                        <span class={`
                            inline-block w-8 text-right select-none mr-4
                            ${darkMode ? 'text-primary-500' : 'text-primary-400'}
                        `}>
                            {index + 1}
                        </span>
                    )}
                    <span class={darkMode ? 'text-green-400' : 'text-green-300'}>
                        {prompt}
                    </span>
                    <span class="ml-2 whitespace-pre-wrap break-all">
                        {command}
                    </span>
                </div>
            ))}
        </pre>
        
        {/* Output area (опционально) */}
        {commands.length > 0 && (
            <div class="mt-4 pt-4 border-t border-primary-800">
                <div class={`
                    text-sm mb-2 flex items-center
                    ${darkMode ? 'text-primary-400' : 'text-primary-300'}
                `}>
                    <svg 
                        class="w-4 h-4 mr-2" 
                        fill="none" 
                        stroke="currentColor" 
                        viewBox="0 0 24 24"
                        aria-hidden="true"
                    >
                        <path 
                            stroke-linecap="round" 
                            stroke-linejoin="round" 
                            stroke-width="2" 
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" 
                        />
                    </svg>
                    Output (simulated)
                </div>
                <div class={`
                    text-sm px-3 py-2 rounded
                    ${darkMode 
                        ? 'bg-primary-900/50 text-primary-300' 
                        : 'bg-primary-800/50 text-primary-200'
                    }
                `}>
                    <span class="text-green-400">✓</span>
                    <span class="ml-2">
                        Command{scommands.length > 1 ? 's' : ''} executed successfully
                    </span>
                </div>
            </div>
        )}
    </div>
</div>

<style>
    .terminal-block {
        container-type: inline-size;
    }
    
    .terminal-line {
        line-height: 1.6;
    }
    
    /* Подсветка синтаксиса для разных языков */
    .terminal-line span:last-child {
        color: theme('colors.primary.100');
    }
    
    /* Стили для скроллбара в терминале */
    .terminal-block pre::-webkit-scrollbar {
        height: 8px;
    }
    
    .terminal-block pre::-webkit-scrollbar-track {
        background: theme('colors.primary.900');
        border-radius: 4px;
    }
    
    .terminal-block pre::-webkit-scrollbar-thumb {
        background: theme('colors.primary.700');
        border-radius: 4px;
    }
    
    .terminal-block pre::-webkit-scrollbar-thumb:hover {
        background: theme('colors.primary.600');
    }
    
    /* Анимация мигающего курсора */
    @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0; }
    }
    
    .terminal-line:last-child::after {
        content: '▋';
        animation: blink 1s infinite;
        color: theme('colors.green.400');
        margin-left: 2px;
    }
    
    /* Адаптивность */
    @container (max-width: 640px) {
        .terminal-line {
            font-size: 0.875rem;
        }
        
        .terminal-line span:first-child {
            display: none;
        }
    }
</style>

<script>
    // Добавляем функциональность копирования
    if (typeof window !== 'undefined') {
        // Инициализация кнопок копирования
        document.addEventListener('DOMContentLoaded', () => {
            const terminalBlocks = document.querySelectorAll('.terminal-block');
            
            terminalBlocks.forEach(block => {
                const copyButton = block.querySelector('button[aria-label="Copy commands to clipboard"]');
                if (copyButton) {
                    copyButton.addEventListener('click', function() {
                        const commands = Array.from(block.querySelectorAll('.terminal-line span:last-child'))
                            .map(span => span.textContent)
                            .join('\n');
                        
                        navigator.clipboard.writeText(commands).then(() => {
                            const originalText = this.textContent;
                            this.textContent = 'Copied!';
                            this.classList.add('bg-green-500', 'text-white', 'border-green-500');
                            
                            setTimeout(() => {
                                this.textContent = originalText;
                                this.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                            }, 2000);
                        });
                    });
                }
            });
        });
    }
</script>